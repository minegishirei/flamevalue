
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="{{ description }}">
    <meta name="author" content="">

    <title>{{ title }}</title>

    <!-- Custom fonts for this template-->
    <link href="/static/dashboard/css/all.min.css" rel="stylesheet" type="text/css">
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="/static/dashboard/css/sb-admin-2.min.css" rel="stylesheet">
    <link rel="icon" type="image/png" sizes="96x96" href="{{ favicon }}">

        <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-B6Y7NSQNF5"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-B6Y7NSQNF5');
    </script>
    <!-- TWITTER -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@se_maintain">
    <meta name="twitter:creator" content="@se_maintain">
    <meta name="twitter:title" content="{{ title }}">
    <meta name="twitter:description" content="{{ description }}">
    <meta name="twitter:image" content="{{ img }}">

</head>


<body>
    <header>
        <h1 id="title_id">
            <a id="twitter_link" href="https://twitter.com/{{ acount_name }}">
                {{ acount_name }}
            </a>
        </h1>
        <style>
            #twitter_link {
                color: white;
            }
        </style>
        <h2 id="description_id">
            <a id="twitter_link" href="./{{ acount_name }}">
                make {{ acount_name }} network
            </a>
        </h2>

    </header>

    <svg style="background-color:#001c33">
    </svg>
    <style>
        svg {
            width: 100%;
            height: 10000px;
        }
        body {
            background-color: #001c33;
        }
        h1 { font-size: 36px; margin: 10px 0; text-transform: uppercase; font-weight: normal;}
      h2, h3 { font-size: 18px; margin: 5px 0 ; font-weight: normal;}
      header {padding: 20px; position: absolute; top: 0; left: 0; z-index: 555;
      color: white;
      }
    </style>
    <div class="right_up_buttons">
        <a href="./">
            <img width="75px" src="/static/fanstatic/home.png">
        </a>    
    </div>

    <div class="right_down_buttons">
        <a href="{{ information_page_link }}">
            <img width="75px" src="/static/fanstatic/question.png">
        </a>    
    </div>
    <style>
        .right_up_buttons {
            z-index: 555;
            position: absolute;
            top:2%; 
            right:2%;
        }
        .right_down_buttons {
            z-index: 555;
            position: absolute;
            bottom:2%; 
            right:2%;
        }
    </style>

    <script src="https://d3js.org/d3.v4.min.js"></script>

    <script>
        var R = 25
        var svg = d3.select("svg"),
            width = +svg.attr("width"),
            height = +svg.attr("height");
        
            
        var color = d3.scaleOrdinal()
            .range(["#f7d147", "#03a6a6", "#fe736c", "#ec5a31", "#d8345f", "#a7d129", "#f8eeb4", "#fe736c", "#616f39", "#ff6363", "#a7d129", "#d8345f", "#db2ae2"]);

        var simulation = d3.forceSimulation()
            .velocityDecay(0.4) //摩擦
            .force('charge', d3.forceManyBody()) //詳細設定は後で
            .force('link', d3.forceLink().id(function (d) {
                return d.name;
            })) //詳細設定は後で
            .force('colllision', d3.forceCollide(40)) //nodeの衝突半径：Nodeの最大値と同じ
            .force('positioningX', d3.forceX()) //詳細設定は後で
            .force('positioningY', d3.forceY()) //詳細設定は後で
            .force('center', d3.forceCenter(width / 2, height / 2)); //重力の中心
        
        //"svg"にZoomイベントを設定
        var zoom = d3.zoom()
            .scaleExtent([1 / 4, 4])
            .on('zoom', SVGzoomed);

        svg.call(zoom);

        //"svg"上に"g"をappendしてdragイベントを設定
        var g = svg.append("g")
            .call(d3.drag()
                .on('drag', SVGdragged))

        function SVGzoomed() {
            g.attr("transform", d3.event.transform);
        }

        function SVGdragged(d) {
            d3.select(this).attr('cx', d.x = d3.event.x).attr('cy', d.y = d3.event.y);
        };

        d3.json("https://raw.githubusercontent.com/kawadasatoshi/twitter_network/main/{{ acount_name }}", function (error, graph) {
            if (error) throw error;


            var link = g.append("g") //svg⇒gに
                .attr("class", "links")
                .selectAll("line")
                .data(graph.links)
                .enter().append("line")
                .attr("stroke", "#666666") //輪郭線の色指定追加
                .attr("stroke-width", function (d) {
                    return Math.sqrt(d.value*10);
                });

            // nodeの定義
            var node = g.append('g')
                .attr('class', 'nodes')
                .selectAll('g')
                .data(graph.nodes)
                .enter()
                .append('g')
                .call(d3.drag()
                    .on('start', dragstarted)
                    .on('drag', dragged)
                    .on('end', dragended));

            node.append("svg:image")
                .attr("xlink:href", function (d) { return d.img; })
                .attr("height", R*2)
                .attr("width", R*2)
                .attr('clip-path', 'url(#clip)')
                .attr("x", function (d) { return -R; })
                .attr("y", function (d) { return -R; })
            
            node.on('click', function(d){
                    change_description(d.name)
                    change_title(d.name)
                });

            //図形判定
            function nodeTypeID(d) {
                var nodetype
                var arrRect = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 0]

                if (arrRect.indexOf(d) >= 0) {
                    //Rect
                    return "rect"
                } else {
                    //Circle
                    return "circle"
                }
            }

            var Defs = svg.append("defs");
            
            var circles = Defs
                .append('circle')
                .attr('id', 'circle')
                .attr('r', R)
                .attr('cx', 0)
                .attr('cy', 0);

            Defs.append('clipPath')
                .attr('id', 'clip')
                .append('use')
                .attr('xlink:href', '#circle');

            simulation
                .nodes(graph.nodes)
                .on("tick", ticked);

            simulation.force("link")
                .links(graph.links);

            simulation.force('charge')
                .strength(function (d) {
                    return -1000
                }) //node間の力

            simulation.force('positioningX') //X方向の中心に向けた引力
                .strength(0.3)

            simulation.force('positioningY') //Y方向の中心に向けた引力
                .strength(0.3)

            function ticked() {
                link
                    .attr("x1", function (d) {
                        return d.source.x;
                    })
                    .attr("y1", function (d) {
                        return d.source.y;
                    })
                    .attr("x2", function (d) {
                        return d.target.x;
                    })
                    .attr("y2", function (d) {
                        return d.target.y;
                    });

                node
                    .attr("cx", function (d) {
                        return d.x;
                    })
                    .attr("cy", function (d) {
                        return d.y;
                    })
                    .attr('transform', function (d) {
                        return 'translate(' + d.x + ',' + d.y + ')'
                    }); //nodesの要素が連動して動くように設定
            }
        });

        function dragstarted(d) {
            if (!d3.event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(d) {
            d.fx = d3.event.x;
            d.fy = d3.event.y;
        }

        function dragended(d) {
            if (!d3.event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        function change_description(description){
            description_element = document.getElementById("description_id");
            description_element.innerHTML = `
            <a id="twitter_link" href="./`+ description +`"> click and make `
            +description+
            `network</a>`

        }
    
        function change_title(new_title){
            title_element = document.getElementById("title_id");
            title_element.innerHTML = `
            <a target=”_blank” id="twitter_link" href="https://twitter.com/`+ new_title +`"> `
            +new_title+
            `</a>`
        }
    </script>



</body>

</html>